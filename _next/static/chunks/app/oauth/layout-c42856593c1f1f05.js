(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[412],{4536:(e,t,r)=>{Promise.resolve().then(r.bind(r,3687))},4979:(e,t,r)=>{"use strict";var o=r(4674);r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},3687:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var o=r(2265),a=r(4979),n=r(1083),s=r(7437);function c(e){let{children:t}=e,r=(0,a.useRouter)(),{0:c,1:l}=(0,o.useState)(!0),u=(0,n.tN)(e=>e.authenticated);return((0,o.useEffect)(()=>{localStorage.getItem("accessToken")||u?r.replace("/chat"):l(!1)},[u]),c)?null:(0,s.jsx)(s.Fragment,{children:t})}},1545:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var o=r(6975),a=r(1083);let n=o.Z.create({baseURL:"https://foodnutrition-ai-backend.vercel.app/",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{let t=localStorage.getItem(a.Wx);return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e}),n.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){r._retry=!0;try{let e=localStorage.getItem(a.w4);if(!e)throw Error("No refresh token available");let{accessToken:t,refreshToken:s}=(await o.Z.post("".concat("https://foodnutrition-ai-backend.vercel.app/","/auth/refresh"),{refreshToken:e})).data;return localStorage.setItem(a.Wx,t),localStorage.setItem(a.w4,s),n.defaults.headers.Authorization="Bearer ".concat(t),r.headers&&(r.headers.Authorization="Bearer ".concat(t)),n(r)}catch(e){return localStorage.removeItem(a.Wx),localStorage.removeItem(a.w4),Promise.reject(e)}}return Promise.reject(e)});let s=n},1083:(e,t,r)=>{"use strict";r.d(t,{Wx:()=>d,tN:()=>f,w4:()=>h});var o=r(665),a=r(6975),n=r(6507),s=r(3388),c=r(3303),l=r(1545);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){(0,o.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let d="accessToken",h="refreshToken",f=(0,c.U)((0,s.mW)((e,t)=>({user:{email:"",featureSet:"",consent:[]},accessToken:null,refreshToken:null,authenticated:null,loadToken:async()=>{let e=localStorage.getItem(d),r=localStorage.getItem(h);if(e&&r)return t().loadUser(e,r,!1);t().onLogout()},loadUser:async(r,o,a)=>{let s=i({},t().user);try{let e=(0,n.o)(r);e.email&&(s.email=e.email),e.featureSet&&(s.featureSet=e.featureSet),e.consent&&(s.consent=e.consent)}catch(e){console.log(e)}l.Z.defaults.headers.common.Authorization="Bearer ".concat(r),e({user:i({},s),accessToken:r,refreshToken:o,authenticated:!0}),a&&(localStorage.setItem(d,r),localStorage.setItem(h,o))},onRegister:async(e,t,r,o)=>{try{let a={consent:e};if(t&&r)a=i({email:t,password:r},a);else{if(!o)return{error:!0,msg:"Please provide credentials"};a=i({ssoToken:o},a)}return await l.Z.post("authentication/register",a)}catch(e){var a,n;return{error:!0,msg:null!==(a=null==e||null===(n=e.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.message)&&void 0!==a?a:"No Internet Connection"}}},onLogin:async(e,r)=>{try{let o=await l.Z.post("authentication/login",{email:e,password:r}),{accessToken:a,refreshToken:n}=o.data;return t().loadUser(a,n,!0),o}catch(e){var o,a;return{error:!0,msg:null!==(o=null==e||null===(a=e.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)&&void 0!==o?o:"No Internet Connection"}}},onLogout:async()=>{localStorage.removeItem(d),localStorage.removeItem(h),a.Z.defaults.headers.common.Authorization="",e({accessToken:null,refreshToken:null,authenticated:!1})}})))}},e=>{var t=t=>e(e.s=t);e.O(0,[739,130,427,744],()=>t(4536)),_N_E=e.O()}]);